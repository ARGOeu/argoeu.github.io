<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title></title>
  <link rel="alternate" type="application/atom+xml" title="API Changes" href="/changes.atom" />
  <link href="/css/reset.css" rel="stylesheet" type="text/css" />
  <link href="/css/960.css" rel="stylesheet" type="text/css" />
  <link href="/css/uv_active4d.css" rel="stylesheet" type="text/css" />
  <link href="/shared/css/documentation.css" media="screen" rel="stylesheet" type="text/css">
  <link href="/shared/css/pygments.css" media="screen" rel="stylesheet" type="text/css">
  <script src="/shared/js/jquery.js" type="text/javascript"></script>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans+Condensed:700,300,300italic' rel='stylesheet' type='text/css'>

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
<!-- Optional theme -->
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">
<!-- Latest compiled and minified JavaScript -->
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

<script>
  $(function () {
    $('#myTab a:last').tab('show')
  })
</script>


<body class="api">
  <header itemtype="http://schema.org/WPHeader" itemscope="itemscope" role="banner" class="site-header" id="header">
	<div class="container">
		<div class="title-area">
			<div class="site-title" itemtype="http://schema.org/Organization" itemscope="">
					<img src="/shared/images/argo-logo.png" itemprop="logo">
			</div>
		</div>
	</div>
</header>

<nav role="navigation" class="navbar navbar-default">
  <div class="container">
    <div class="navbar-header">
      <button data-target=".bs-navbar-collapse" data-toggle="collapse" type="button" class="navbar-toggle">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>

    <nav role="navigation" class="collapse navbar-collapse bs-navbar-collapse">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="/guides/overview" class="nav-overview">Overview</a></li>
        <li><a href="/guides/api/" class="nav-api">API</a></li>
<!--
        <li><a href="/guides/glossary/" class="nav-blog">Glossary</a></li>
-->
      </ul>
    </nav>
  </div>
</nav>
<!--<div id="header-wrapper">
-->
<!--  <div id="header">
    <div>
      <a class="logo" href="/">GRNET PID Service</a>
      <ul class="nav">
        <li><a href="/guides/overview" class="nav-overview">Overview</a></li>
        <li><a href="/guides/api/" class="nav-api">API</a></li>
        <li><a href="/guides/glossary/" class="nav-blog">Glossary</a></li>
      </ul>
    </div>
    </div>
    </div>
-->


  <div id="wrapper">
    <div class="content">
      <h1 id="poem-service-for-argo-framework">POEM service for ARGO framework</h1>

<h2 id="changes">Changes</h2>

<p>POEM for ARGO supports CentOS 6, it is reduced, simplified, easier to deploy and maintain and is much more lightweight than previous versions. Key components that were either dumped or substituted:</p>

<ul>
  <li>MySQL, Oracle: it is replaced with a much more lightweight SQLite</li>
  <li>ATP bridge: since ATP is gone, POEM now syncs data from GOCDB and Operations portal</li>
  <li>poem-sync: removed which led to great simplification of DB model</li>
</ul>

<h2 id="configuration">Configuration</h2>

<h3 id="database">Database</h3>

<p>Prior any work, database needs to be created. Provided script do that for you and <em>need to be executed as root immediately</em> after an installation.</p>

<p><code>poem-createdb</code> - create all necessary database models and POEM superuser account for managing and delegating other cert-authenticated users to handle profiles.</p>

<p><strong>Examples</strong></p>

<pre><code>[root@vcl-0-100 ~]# poem-createdb
Creating tables ...
Creating table auth_permission
Creating table auth_group_permissions
Creating table auth_group
Creating table auth_user_user_permissions
Creating table auth_user_groups
Creating table auth_user
Creating table django_content_type
Creating table django_session
Creating table django_admin_log
Creating table poem_userprofile
Creating table poem_vo
Creating table poem_serviceflavour
Creating table poem_profile
Creating table poem_metricinstance

You just installed Django's auth system, which means you don't have any
superusers defined.
Would you like to create one now? (yes/no): yes
Username (leave blank to use 'apache'): dvrcic
E-mail address: dvrcic@srce.hr
Password:
Password (again):
Superuser created successfully.
Installing custom SQL ...
Installing indexes ...
Installed 0 object(s) from 0 fixture(s)
</code></pre>

<p>POEM superuser account can be automatically created so poem-createdb script doesn’t need to be necessarily interactive, but superuser credentials then must be provided in the config file.</p>

<pre><code>[general]
SUPERUSER_NAME: dvrcic
SUPERUSER_PASSWORD: testbed
SUPERUSER_EMAIL: dvrcic@srce.hr
</code></pre>

<p>There are no config options related to database, it’s just a file with appropriate permissions placed into:</p>

<p><code>/var/lib/poem/poemserv.db</code></p>

<h3 id="profiles-import">Profiles import</h3>

<p><code>poem-importprofiles</code> - can import all profiles like ROC, ROC_CRITICAL, ROC_OPERATORS and GLEXEC from another POEM instance. If POEM instance is not specified at command line, then central one will be used (<code>mon.egi.eu</code>)</p>

<p><strong>Examples</strong></p>

<pre><code>[root@vcl-0-100 ~]# poem-importprofiles
Usage: poem-importprofiles [-i] [-url &lt;URL&gt;] PROFILE1 PROFILE2 ...
       [-i] - Only import profiles if poem database is empty
       [-u &lt;URL&gt;] - URL containing JSON encoded list of profiles
       PROFILE1 PROFILE2 - space separated list of profiles

[root@vcl-0-100 ~]# poem-importprofiles ROC ROC_CRITICAL ROC_OPERATORS GLEXEC
2014-12-02 14:14:56,257 - POEM - INFO - Running synchronizer for POEM sync
2014-12-02 14:14:57,325 - POEM - INFO - Synchronized profile ROC 1.0 ops
2014-12-02 14:14:57,666 - POEM - INFO - Running synchronizer for POEM sync
2014-12-02 14:14:58,285 - POEM - INFO - Synchronized profile ROC_CRITICAL 1.0 ops
2014-12-02 14:14:58,644 - POEM - INFO - Running synchronizer for POEM sync
2014-12-02 14:14:59,551 - POEM - INFO - Synchronized profile ROC_OPERATORS 1.0 ops
2014-12-02 14:14:59,910 - POEM - INFO - Running synchronizer for POEM sync
2014-12-02 14:15:00,674 - POEM - INFO - Synchronized profile GLEXEC 1.0 ops
</code></pre>

<h3 id="autocompletion-of-vo-and-service-flavours-fields-in-web-ui">Autocompletion of VO and Service Flavours fields in Web UI</h3>

<p>Data is synced from Operations Portal and GOCDB, respectively, with the help of two provided scripts:</p>

<p><code>poem-syncvo</code>, <code>poem-syncservtype</code> - scripts need to be executed as root immediately after an installation. Subsequent syncs from both sources are executed every hour as a part of a cron job.</p>

<p><strong>Examples:</strong></p>

<pre><code>[root@vcl-0-100 ~]# poem-syncvo
2014-12-02 14:17:27,629 - POEM - INFO - Added 216 VO
[root@vcl-0-100 ~]# poem-syncservtype
2014-12-02 14:17:50,333 - POEM - INFO - Added 111 service flavours
</code></pre>

<p>There are a new config file options introduced:</p>

<pre><code>GOCDB_SERVICETYPE_URL: https://goc.egi.eu/gocdbpi/private/?method=get_service_types
CIC_VO_URL: http://operations-portal.egi.eu/xml/voIDCard/public/all/true
HOST_CERT = /etc/grid-security/hostcert.pem
HOST_KEY = /etc/grid-security/hostkey.pem
</code></pre>

<p>Certificate is needed for access to GOCDB feed.</p>

<h2 id="rest-api">REST API</h2>

<p>POEM exposes it’s data to NCG and ARGO/ar-sync components via two available APIes:</p>

<p><strong>NCG</strong>: <code>/api/0.2/json/profiles/</code></p>

<p>Returned fields are all available profiles with associated service types and metrics. Some fields like valid_to, valid_from, groups and extensions are kept because of transition period in which poem-sync will still be lurking around. For the same reason, name of fields like atp_vo and atp_service_type_flavour are not changed, although ATP is removed. </p>

<p><strong>Example:</strong></p>

<pre><code>{
    "name": "GLEXEC",
    "atp_vo": "ops",
    "version": "1.0",
    "owner": "/C=HR/O=edu/OU=srce/CN=Daniel Vrcic",
    "description": "test-dn",
    "metric_instances": 
    [
        {
            "metric": "emi.cream.glexec.CREAMCE-JobSubmit",
            "fqan": "/ops/Role=pilot",
            "vo": "ops",
            "atp_service_flavour": "gLExec"
        },
        {
            "metric": "emi.cream.glexec.WN-gLExec",
            "fqan": "/ops/Role=pilot",
            "vo": "ops",
            "atp_service_flavour": "gLExec"
        }
    ]
}
</code></pre>

<p><strong>ARGO</strong>: <code>/api/0.2/json/metrics_in_profiles/?vo_name=VO[&amp;profile_name=PROFILE]</code></p>

<ul>
  <li>mandatory args - vo_name=VO</li>
  <li>optional args - profile_name=PROFILE</li>
</ul>

<p>Returned fields are a list of all available metrics across all profiles for a specified VO. List can be further filtered for a specific profile name.</p>

<p><strong>Examples</strong>:</p>

<pre><code>{
    "name": "ops",
    "profiles": [
        {
            "namespace": "CH.CERN.SAM",
            "name": "ROC_OPERATORS",
            "description": "The main profile that contains Operations tests."
            "metrics": [
                {
                    "service_flavour": "APEL",
                    "fqan": "",
                    "name": "org.apel.APEL-Pub",
                },
                {
                    "service_flavour": "ARC-CE",
                    "fqan": "",
                    "name": "org.nordugrid.ARC-CE-ARIS",
                },
            ],
        },
    ]
}
</code></pre>

<h2 id="things-to-consider-for-future">Things to consider for future</h2>

<ul>
  <li>handle a DB schema update - Django-South</li>
  <li>bootstrap theme</li>
</ul>


 <!--end item[:slug]-->
 </div>


    <div id="js-sidebar" class="sidebar-shell">
      <div class="sidebar-module">
        <ul>
          <li><h3><a href="/guides/overview">Overview</a></h3></li>
          <li><h3><a href="/guides/installation">Installation</a></h3></li>
          <li><h3><a href="#">Components</a></h3></li>
          <li><ul>
                <li><h3><a href="/guides/sync/">Sync Components</a></h3></li>
                <li><h3><a href="/guides/poem/">Poem Service</a></h3></li>
                <li><h3><a href="/guides/consumer/">Consumer</a></h3></li>
                <li><h3><a href="/guides/compute/">Compute Engine</a></h3></li>
                <li><h3><a href="/guides/api/">API</a></h3></li>
                <li><h3><a href="/guides/webui/">Web UI</a></h3></li>
          </ul></li>
        </ul> 
      </div>
      
<!--
<div class="sidebar-module notice padding10">
  <strong>API Url:</strong>
  <span>  The API URL (https://epic.grnet.gr/api/v2/handles/) is used as an example in these page. Each EPIC provider has each own EPIC API endpoint(s)</span>
</div>
-->
      <div class="sidebar-module padding10">
          <strong>Contact Us:</strong>
           <a href="mailto:argo-ggus-support@grnet.gr" target='blank'>Contact Us</a>
      </div><!--sidebar-module-->
	</div>
  </div><!-- #wrapper -->

  <footer itemtype="http://schema.org/WPFooter" itemscope="itemscope" role="contentinfo" class="site-footer" id="footer">
	<div class="wrap">
		<p>&nbsp;</p>
		<div class="footer-content footer-insert">
		<p class="copyright">Copyright &copy; 2014 <a rel="home" href="mailto:argo-ggus-support@grnet.gr" class="site-link" target='_blank'>ARGO Consortium</a>.</p>
		</div>
	</div>
</footer>

</body>
</html>


